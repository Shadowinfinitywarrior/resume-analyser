{% extends "base.html" %}

{% block title %}Screening Pipeline - ResumeAI{% endblock %}

{% block content %}
<div class="fade-in">
    <div
        style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 3rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2rem;">
        <div>
            <h2
                style="font-size: 3rem; font-weight: 800; letter-spacing: -0.04em; margin-bottom: 0.5rem; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                Screening Intelligence</h2>
            <p style="color: var(--text-muted); font-size: 1.1rem;">
                Pipeline for <span style="color: var(--primary); font-weight: 700;">{{ job.title }}</span>
                &bull; <span style="font-weight: 600;">{{ candidates|length }} NODES ANALYZED</span>
            </p>
        </div>
        <a href="{{ url_for('hr_dashboard') }}" class="btn btn-secondary"
            style="border-radius: 100px; padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.05); color: white; border: 1px solid rgba(255,255,255,0.1); font-weight: 700;">
            <span>&larr; Return to Central</span>
        </a>
    </div>

    {% if candidates %}
    <div class="grid grid-3" style="margin-bottom: 3rem; gap: 2rem;">
        <div class="card stat-card"
            style="border-bottom: 4px solid var(--success); background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(17, 24, 39, 0.7));">
            <div class="stat-label" style="letter-spacing: 0.1em; font-weight: 800;">RECOMMENDED</div>
            <div class="stat-value" style="color: var(--success); font-size: 3.5rem;">
                {{ candidates|selectattr('recommendation', 'equalto', 'Select')|list|length }}
            </div>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">HIGH-POTENTIAL MATCHES</p>
        </div>
        <div class="card stat-card"
            style="border-bottom: 4px solid var(--warning); background: linear-gradient(135deg, rgba(245, 158, 11, 0.05), rgba(17, 24, 39, 0.7));">
            <div class="stat-label" style="letter-spacing: 0.1em; font-weight: 800;">FOR REVIEW</div>
            <div class="stat-value" style="color: var(--warning); font-size: 3.5rem;">
                {{ candidates|selectattr('recommendation', 'equalto', 'Review')|list|length }}
            </div>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">PARTIAL SYNERGY DETECTED</p>
        </div>
        <div class="card stat-card"
            style="border-bottom: 4px solid var(--danger); background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(17, 24, 39, 0.7));">
            <div class="stat-label" style="letter-spacing: 0.1em; font-weight: 800;">NOT SUITABLE</div>
            <div class="stat-value" style="color: var(--danger); font-size: 3.5rem;">
                {{ candidates|selectattr('recommendation', 'equalto', 'Reject')|list|length }}
            </div>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">LOW COMPATIBILITY VECTORS</p>
        </div>
    </div>

    <div class="card slide-in" style="border-radius: 32px;">
        <div class="card-header" style="margin-bottom: 2.5rem;">
            <h3 style="font-size: 1.5rem; font-weight: 700;">Intelligence Matrix</h3>
            <span style="font-size: 1.5rem; opacity: 0.5;">üíé</span>
        </div>

        <div style="overflow-x: auto;" class="custom-scrollbar">
            <table style="width: 100%; border-collapse: collapse; min-width: 1000px;">
                <thead>
                    <tr style="text-align: left; border-bottom: 1px solid rgba(255,255,255,0.05);">
                        <th
                            style="padding: 1.5rem 1rem; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); letter-spacing: 0.1em; width: 80px;">
                            RANK</th>
                        <th
                            style="padding: 1.5rem 1rem; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); letter-spacing: 0.1em;">
                            CANDIDATE</th>
                        <th
                            style="padding: 1.5rem 1rem; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); letter-spacing: 0.1em; text-align: center;">
                            AI SCORE</th>
                        <th
                            style="padding: 1.5rem 1rem; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); letter-spacing: 0.1em;">
                            AI JUSTIFICATION</th>
                        <th
                            style="padding: 1.5rem 1rem; font-size: 0.75rem; font-weight: 800; color: var(--text-muted); letter-spacing: 0.1em;">
                            EXECUTIVE ACTION</th>
                    </tr>
                </thead>
                <tbody>
                    {% for candidate in candidates %}
                    <tr style="border-bottom: 1px solid rgba(255,255,255,0.02); transition: all 0.3s ease;"
                        onmouseover="this.style.background='rgba(255,255,255,0.01)'"
                        onmouseout="this.style.background='transparent'">
                        <td style="padding: 1.5rem 1rem;">
                            <span style="font-size: 1.5rem; font-weight: 900; color: rgba(255,255,255,0.1);">#{{
                                loop.index }}</span>
                        </td>
                        <td style="padding: 1.5rem 1rem;">
                            <div style="font-weight: 700; color: #fff; font-size: 1.1rem;">{{ candidate.filename }}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">Analyzed on {{
                                candidate.upload_date }}</div>
                            <div style="margin-top: 1rem;">
                                {% set rec = candidate.recommendation %}
                                <span
                                    class="badge {% if rec == 'Select' %}score-high{% elif rec == 'Review' %}score-medium{% else %}score-low{% endif %}"
                                    style="font-size: 0.7rem; letter-spacing: 0.05em; padding: 0.4rem 0.8rem; border-radius: 50px; font-weight: 800; border: 1px solid;">
                                    AI: {{ rec|upper }}
                                </span>
                            </div>
                        </td>
                        <td style="padding: 1.5rem 1rem; text-align: center;">
                            {% set score = candidate.score|int %}
                            <div class="{% if score >= 70 %}score-high{% elif score >= 50 %}score-medium{% else %}score-low{% endif %}"
                                style="width: 70px; height: 70px; border-radius: 20px; display: inline-flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; border: 2px solid;">
                                {{ score }}%
                            </div>
                        </td>
                        <td style="padding: 1.5rem 1rem;">
                            <div
                                style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.7; max-width: 350px; background: rgba(255,255,255,0.01); padding: 1rem; border-radius: 16px; border: 1px solid rgba(255,255,255,0.03);">
                                {{ candidate.justification }}
                            </div>
                        </td>
                        <td style="padding: 1.5rem 1rem;">
                            <form method="post" action="{{ url_for('update_candidate', candidate_id=candidate.id) }}"
                                style="display: flex; flex-direction: column; gap: 0.75rem;">
                                <input type="hidden" name="job_id" value="{{ job.id }}">
                                <select name="decision"
                                    style="padding: 0.8rem; border-radius: 12px; font-size: 0.9rem; background: rgba(255,255,255,0.05); color: #fff; border: 1px solid rgba(255,255,255,0.1);">
                                    <option value="">STATUS</option>
                                    <option value="Hire" {% if candidate.hr_decision=='Hire' %}selected{% endif %}>‚úÖ
                                        HIRE</option>
                                    <option value="Interview" {% if candidate.hr_decision=='Interview' %}selected{%
                                        endif %}>üìû INTERVIEW</option>
                                    <option value="Reject" {% if candidate.hr_decision=='Reject' %}selected{% endif %}>‚ùå
                                        REJECT</option>
                                </select>
                                <button type="submit" class="btn btn-primary"
                                    style="padding: 0.6rem; border-radius: 50px; font-size: 0.85rem; font-weight: 800;">UPDATE</button>
                            </form>
                            {% if candidate.hr_decision %}
                            <div
                                style="margin-top: 1rem; font-size: 0.75rem; color: var(--primary); font-weight: 800; text-align: center; letter-spacing: 0.05em;">
                                CURRENT: {{ candidate.hr_decision|upper }}
                            </div>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="card" style="padding: 8rem 0; text-align: center; border-radius: 40px;">
        <div style="font-size: 4rem; margin-bottom: 2rem; opacity: 0.1;">üõ∞Ô∏è</div>
        <p style="color: var(--text-muted); font-size: 1.25rem; margin-bottom: 2.5rem;">No candidates discovered in this
            sector yet.</p>
        <a href="{{ url_for('bulk_upload_resumes', job_id=job.id) }}" class="btn btn-primary"
            style="padding: 1.25rem 3rem; border-radius: 100px; font-weight: 800; font-size: 1.1rem;">Initiate Screening
            Sequence</a>
    </div>
    {% endif %}
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar {
        height: 6px;
        width: 6px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
    }
</style>
{% endblock %}